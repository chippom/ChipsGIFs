document.addEventListener("DOMContentLoaded",function(){function f(t){var e={timeZone:"America/New_York",weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"};return new Date(t).toLocaleString("en-US",e)}"caches"in window&&caches.open("my-gif-cache").then(function(c){document.querySelectorAll(".gif-item img").forEach(function(i){var u=i.dataset.gif;/^https?:\/\//.test(u)&&c.add(u).catch(function(e){console.error("Failed to cache:",u,e)})})}).catch(function(e){console.error("Failed to open cache:",e)});var dm=document.getElementById("toggleDarkMode"),bd=document.body;dm&&dm.addEventListener("click",function(){bd.classList.toggle("dark-mode"),localStorage.setItem("darkMode",bd.classList.contains("dark-mode"))}),"true"===localStorage.getItem("darkMode")&&bd.classList.add("dark-mode");var gc=document.querySelector(".gif-container");gc&&gc.addEventListener("click",function(e){if(!e.target.classList.contains("download-btn")){var itm=e.target.closest(".gif-item");if(itm){var img=itm.querySelector("img");img.dataset.gif&&(img.src=img.dataset.gif);var ov=document.querySelector(".fullsize-overlay");ov&&document.body.removeChild(ov);var d=document.createElement("div");d.className="fullsize-overlay";var fi=document.createElement("img");fi.src=img.src,fi.className="fullsize-image",d.appendChild(fi),document.body.appendChild(d),d.addEventListener("click",function(){document.body.removeChild(d)})}}});var sc=document.createElement("div");sc.style.position="fixed",sc.style.pointerEvents="none",sc.style.zIndex="9999",document.body.appendChild(sc);for(var stars=[],n=5,i=0;i<n;i++){var s=document.createElement("div");s.textContent="★",s.className="star",sc.appendChild(s),stars.push(s)}var si=0;document.addEventListener("mousemove",function(e){null!=e.clientX&&null!=e.clientY&&(stars[si].style.left=e.clientX+"px",stars[si].style.top=e.clientY+"px",stars[si].style.opacity="1",setTimeout(function(){stars[si].style.opacity="0"},500),si=(si+1)%n)});document.querySelectorAll(".download-btn").forEach(function(btn){var g=btn.dataset.gif,ce=btn.nextElementSibling;fetch("/.netlify/functions/get-download-count?gif_name="+encodeURIComponent(g)).then(function(r){return r.json()}).then(function(d){ce&&(ce.textContent="Downloads: "+d.count)}).catch(function(){}),btn.addEventListener("click",async function(){btn.disabled=!0,btn.textContent="Downloading…";try{await fetch("/.netlify/functions/update-download-count",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gif_name:g})});var r2=await fetch("/.netlify/functions/deliver_gif?gif_name="+encodeURIComponent(g));if(!r2.ok)throw new Error(r2.statusText);var blob=await r2.blob(),u2=URL.createObjectURL(blob),a=document.createElement("a");a.href=u2,a.download=g,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(u2);var r3=await fetch("/.netlify/functions/get-download-count?gif_name="+encodeURIComponent(g)),d3=await r3.json();ce&&(ce.textContent="Downloads: "+d3.count)}catch(err){console.error("❌ Download error:",err)}finally{btn.disabled=!1,btn.textContent="Download GIF"}})});var io=new IntersectionObserver(function(entries){entries.forEach(function(entry){if(entry.isIntersecting){var img=entry.target;img.dataset.gif&&img.src.includes("placeholder.jpg")&&(img.src=img.dataset.gif,io.unobserve(img))}})},{rootMargin:"400px"});document.querySelectorAll(".gif-item img").forEach(function(img){img.dataset.gif=img.src,img.src="gifs/placeholder.jpg",io.observe(img)});function scb(){var b=document.createElement("div");b.id="consent-banner",b.innerHTML='<p>We use cookies to ensure you get the best experience. <button id="acceptConsent">Accept</button></p>',document.body.appendChild(b),b.querySelector("button").addEventListener("click",function(){b.style.display="none",localStorage.setItem("cookiesAccepted","true"),document.querySelectorAll(".download-btn").forEach(function(bn){bn.disabled=!1})})}"true"===localStorage.getItem("cookiesAccepted")?document.querySelectorAll(".download-btn").forEach(function(bn){bn.disabled=!1}):(document.querySelectorAll(".download-btn").forEach(function(bn){bn.disabled=!0}),scb())});