document.addEventListener("DOMContentLoaded",function(){function f(t){const e={timeZone:"America/New_York",weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"};return new Date(t).toLocaleString("en-US",e)}if("caches"in window)caches.open("my-gif-cache").then(function(t){document.querySelectorAll(".gif-item img").forEach(function(e){var n=e.dataset.src||e.src;/^https?:\/\//.test(n)&&t.add(n).catch(function(t){console.error("Failed to cache:",n,t)})})}).catch(function(t){console.error("Failed to open cache:",t)});var e=document.getElementById("toggleDarkMode"),t=document.body;e&&e.addEventListener("click",function(){t.classList.toggle("dark-mode"),localStorage.setItem("darkMode",t.classList.contains("dark-mode"))}),"true"===localStorage.getItem("darkMode")&&t.classList.add("dark-mode");var n=document.querySelector(".gif-container");n&&n.addEventListener("click",function(t){if(!t.target.classList.contains("download-btn")){var e=t.target.closest(".gif-item");if(e){var n=e.querySelector("img");n.src.includes("placeholder.jpg")&&n.dataset.src&&(n.src=n.dataset.src);var r=document.querySelector(".fullsize-overlay");r&&document.body.removeChild(r);var o=document.createElement("div");o.className="fullsize-overlay";var a=document.createElement("img");a.src=n.src,a.className="fullsize-image",o.appendChild(a),document.body.appendChild(o),o.addEventListener("click",function(){document.body.removeChild(o)})}}});var r=document.createElement("div");r.style.position="fixed",r.style.pointerEvents="none",r.style.zIndex="9999",document.body.appendChild(r);var o=[],a=5;for(let t=0;t<a;t++){var i=document.createElement("div");i.textContent="★",i.className="star",r.appendChild(i),o.push(i)}let d=0;document.addEventListener("mousemove",function(t){null!=t.clientX&&null!=t.clientY&&(o[d].style.left=t.clientX+"px",o[d].style.top=t.clientY+"px",o[d].style.opacity="1",setTimeout(function(){o[d].style.opacity="0"},500),d=(d+1)%a)});document.querySelectorAll(".download-btn").forEach(function(t){var e=t.dataset.gif,n=t.nextElementSibling;fetch(`/.netlify/functions/get-download-count?gif_name=${encodeURIComponent(e)}`).then(function(t){return t.json()}).then(function(t){if(n){n.textContent=`Downloads: ${t.count}`;if(t.timestamp){const e=f(t.timestamp),r=document.createElement("div");r.textContent=`Last downloaded: ${e}`,n.parentNode.appendChild(r)}}}),t.addEventListener("click",async function(){try{var r=await fetch("/.netlify/functions/update-download-count",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gif_name:e})}),o=await r.json();console.log(`✅ Full response: ${JSON.stringify(o)}`),n&&(n.textContent=`Downloads: ${o.count??"?"}`)}catch(t){console.error("Failed to update global count:",t)}var a=document.createElement("a");a.href=e,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a)})});var c=new IntersectionObserver(function(t,e){t.forEach(function(t){if(t.isIntersecting){var n=t.target;n.src=n.dataset.src,e.unobserve(n)}})},{"rootMargin":"400px"});document.querySelectorAll(".gif-item img").forEach(function(t){t.dataset.src=t.src,t.src="placeholder.jpg",c.observe(t)});function l(){var t=document.createElement("div");t.id="consent-banner",t.innerHTML='<p>We use cookies to ensure you get the best experience. <button id="acceptConsent">Accept</button></p>',document.body.appendChild(t);var e=t.querySelector("button");e.addEventListener("click",function(){t.style.display="none",localStorage.setItem("cookiesAccepted","true"),document.querySelectorAll(".download-btn").forEach(function(t){t.disabled=!1})})}"true"===localStorage.getItem("cookiesAccepted")?document.querySelectorAll(".download-btn").forEach(function(t){t.disabled=!1}):(document.querySelectorAll(".download-btn").forEach(function(t){t.disabled=!0}),l())});