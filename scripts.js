document.addEventListener("DOMContentLoaded",function(){if("caches"in window)caches.open("my-gif-cache").then(function(c){document.querySelectorAll(".gif-item img").forEach(function(i){/^https?:\/\//.test(i.src)&&c.add(i.src).catch(function(e){console.error("Failed to cache:",i.src,e)})})}).catch(function(e){console.error("Failed to open cache:",e)});var t=document.getElementById("toggleDarkMode"),o=document.body;t&&t.addEventListener("click",function(){o.classList.toggle("dark-mode"),localStorage.setItem("darkMode",o.classList.contains("dark-mode"))}),"true"===localStorage.getItem("darkMode")&&o.classList.add("dark-mode");var r=document.querySelector(".gif-container");r&&r.addEventListener("click",function(e){if(e.target.classList.contains("download-btn"))return;var t=e.target.closest(".gif-item");if(t){var n=t.querySelector("img");if(n.src.includes("placeholder.jpg")&&n.dataset.src)n.src=n.dataset.src;var o=document.querySelector(".fullsize-overlay");o&&document.body.removeChild(o);var r=document.createElement("div");r.className="fullsize-overlay";var i=document.createElement("img");i.src=n.src,i.className="fullsize-image",r.appendChild(i),document.body.appendChild(r),r.addEventListener("click",function(){document.body.removeChild(r)})}});var s=document.createElement("div");s.style.position="fixed",s.style.pointerEvents="none",s.style.zIndex="9999",document.body.appendChild(s);var a=[],c=5;for(let e=0;e<c;e++){var l=document.createElement("div");l.textContent="★",l.className="star",s.appendChild(l),a.push(l)}let d=0;document.addEventListener("mousemove",function(e){null!=e.clientX&&null!=e.clientY&&(a[d].style.left=e.clientX+"px",a[d].style.top=e.clientY+"px",a[d].style.opacity="1",setTimeout(function(){a[d].style.opacity="0"},500),d=(d+1)%c)});document.querySelectorAll(".download-btn").forEach(function(e){var t=e.dataset.gif,n=e.nextElementSibling;fetch(`/.netlify/functions/get-download-count?gif_name=${encodeURIComponent(t)}`).then(function(e){return e.json()}).then(function(e){n&&(n.textContent=`Downloads: ${e.count}`)}),e.addEventListener("click",async function(){try{var r=await fetch("/.netlify/functions/update-download-count",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gif_name:t})}),o=await r.json();console.log(`✅ Full response: ${JSON.stringify(o)}`),n&&(n.textContent=`Downloads: ${o.count??"?"}`)}catch(e){console.error("Failed to update global count:",e)}var a=document.createElement("a");a.href=t,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)})});var observer=new IntersectionObserver(function(e,o){e.forEach(function(e){if(e.isIntersecting){var t=e.target;t.src=t.dataset.src,o.unobserve(t)}})},{"rootMargin":"400px"});document.querySelectorAll(".gif-item img").forEach(function(e){e.dataset.src=e.src,e.src="placeholder.jpg",observer.observe(e)});function u(){var e=document.createElement("div");e.id="consent-banner",e.innerHTML='<p>We use cookies to ensure you get the best experience. <button id="acceptConsent">Accept</button></p>',document.body.appendChild(e);var t=e.querySelector("button");t.addEventListener("click",function(){e.style.display="none",localStorage.setItem("cookiesAccepted","true"),document.querySelectorAll(".download-btn").forEach(function(e){e.disabled=false})})}"true"===localStorage.getItem("cookiesAccepted")?document.querySelectorAll(".download-btn").forEach(function(e){e.disabled=false}):(document.querySelectorAll(".download-btn").forEach(function(e){e.disabled=true}),u())});