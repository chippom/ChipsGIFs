document.addEventListener("DOMContentLoaded",function(){if("caches"in window){caches.open("my-gif-cache").then(function(e){document.querySelectorAll(".gif-item img").forEach(function(t){if(t.src.startsWith("http://")||t.src.startsWith("https://")){e.add(t.src).catch(function(e){console.error("Failed to cache:",t.src,e)})}})}).catch(function(e){console.error("Failed to open cache:",e)})}const e=document.getElementById("toggleDarkMode"),t=document.body;e&&e.addEventListener("click",function(){t.classList.toggle("dark-mode"),localStorage.setItem("darkMode",t.classList.contains("dark-mode"))}),"true"===localStorage.getItem("darkMode")&&t.classList.add("dark-mode");const n=document.querySelector(".gif-container");n.addEventListener("click",function(e){if(e.target.classList.contains("download-btn"))return;const t=e.target.closest(".gif-item");if(t){const e=t.querySelector("img"),n=document.querySelector(".fullsize-overlay");n&&document.body.removeChild(n);const o=document.createElement("div");o.className="fullsize-overlay";const a=document.createElement("img");a.src=e.src,a.className="fullsize-image",o.appendChild(a),document.body.appendChild(o),o.addEventListener("click",function(){document.body.removeChild(o)})}});const o=document.createElement("div");o.style.position="fixed",o.style.pointerEvents="none",o.style.zIndex="9999",document.body.appendChild(o);const a=[],c=5;for(let e=0;e<c;e++){const t=document.createElement("div");t.textContent="â˜…",t.className="star",o.appendChild(t),a.push(t)}let i=0;function d(e){if(e&&e.clientX&&e.clientY){const t=a[i];t.style.left=e.clientX+"px",t.style.top=e.clientY+"px",t.style.opacity="1",setTimeout(()=>{t.style.opacity="0"},500),i=(i+1)%c}}document.addEventListener("mousemove",d),document.querySelectorAll(".download-btn").forEach(function(e){const t=e.getAttribute("data-gif"),n=e.nextElementSibling,o=localStorage.getItem(`downloads_${t}`)||0;n&&(n.textContent=`Downloads: ${o}`),e.addEventListener("click",async function(){const n=this.getAttribute("data-gif"),o=document.createElement("a");o.href=n,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o);const a=this.nextElementSibling;if(a){let e=parseInt(localStorage.getItem(`downloads_${n}`)||0);e++,localStorage.setItem(`downloads_${n}`,e),a.textContent=`Downloads: ${e}`;try{const t=await fetch("/.netlify/functions/update-download-count",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gif_name:n})}),c=await t.json();t.ok&&c.count!==void 0&&(a.textContent=`Downloads: ${c.count}`)}catch(e){console.error("Failed to update global count:",e)}}})}),document.querySelectorAll(".gif-item img").forEach(function(e){const t=e.src;e.src="placeholder.jpg",e.dataset.src=t});const r=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,t.unobserve(n)}})},{rootMargin:"400px"});document.querySelectorAll(".gif-item img").forEach(function(e){r.observe(e)});function s(){const e=document.createElement("div");e.id="consent-banner",e.innerHTML='<p>We use cookies to ensure you get the best experience. <button id="acceptConsent">Accept</button></p>',document.body.appendChild(e);const t=e.querySelector("button");t.addEventListener("click",function(){e.style.display="none",localStorage.setItem("cookiesAccepted","true"),document.querySelectorAll(".download-btn").forEach(function(e){e.disabled=!1})})}"true"===localStorage.getItem("cookiesAccepted")?document.querySelectorAll(".download-btn").forEach(function(e){e.disabled=!1}):(document.querySelectorAll(".download-btn").forEach(function(e){e.disabled=!0}),s())});
