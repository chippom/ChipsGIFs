document.addEventListener("DOMContentLoaded",function(){if("caches"in window)caches.open("my-gif-cache").then(function(e){document.querySelectorAll(".gif-item img").forEach(function(t){if(t.src.startsWith("http://")||t.src.startsWith("https://"))e.add(t.src).catch(function(e){console.error("Failed to cache:",t.src,e)})})}).catch(function(e){console.error("Failed to open cache:",e)});const e=document.getElementById("toggleDarkMode"),t=document.body;e&&e.addEventListener("click",function(){t.classList.toggle("dark-mode"),localStorage.setItem("darkMode",t.classList.contains("dark-mode"))}),"true"===localStorage.getItem("darkMode")&&t.classList.add("dark-mode");const n=document.querySelector(".gif-container");n&&n.addEventListener("click",function(e){if(e.target.classList.contains("download-btn"))return;const t=e.target.closest(".gif-item");if(t){const e=t.querySelector("img"),n=document.querySelector(".fullsize-overlay");n&&document.body.removeChild(n);const o=document.createElement("div");o.className="fullsize-overlay";const a=document.createElement("img");a.src=e.src,a.className="fullsize-image",o.appendChild(a),document.body.appendChild(o),o.addEventListener("click",function(){document.body.removeChild(o)})}});const o=document.createElement("div");o.style.position="fixed",o.style.pointerEvents="none",o.style.zIndex="9999",document.body.appendChild(o);const a=[],c=5;for(let e=0;e<c;e++){const t=document.createElement("div");t.textContent="★",t.className="star",o.appendChild(t),a.push(t)}let i=0;document.addEventListener("mousemove",function(e){if(e&&e.clientX!=null&&e.clientY!=null){const t=a[i];t.style.left=e.clientX+"px",t.style.top=e.clientY+"px",t.style.opacity="1",setTimeout(function(){t.style.opacity="0"},500),i=(i+1)%c}});document.querySelectorAll(".download-btn").forEach(function(e){const t=e.dataset.gif,n=e.nextElementSibling;fetch(`/.netlify/functions/get-download-count?gif_name=${encodeURIComponent(t)}`).then(function(r){return r.json()}).then(function(r){n&&(n.textContent=`Downloads: ${r.count}`)}),e.addEventListener("click",async function(){const gif=this.dataset.gif,countEl=this.nextElementSibling;try{const res=await fetch("/.netlify/functions/update-download-count",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gif_name:gif})}),data=await res.json();console.log(`✅ Full response: ${JSON.stringify(data)}`),countEl&&(countEl.textContent=`Downloads: ${data.count??"?"}`)}catch(err){console.error("Failed to update global count:",err)}const link=document.createElement("a");link.href=gif,link.download=gif,document.body.appendChild(link),link.click(),document.body.removeChild(link)})});document.querySelectorAll(".gif-item img").forEach(function(e){const t=e.src;e.src="placeholder.jpg",e.dataset.src=t});const r=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,t.unobserve(n)}})},{rootMargin:"400px"});document.querySelectorAll(".gif-item img").forEach(function(e){r.observe(e)});function s(){const e=document.createElement("div");e.id="consent-banner",e.innerHTML='<p>We use cookies to ensure you get the best experience. <button id="acceptConsent">Accept</button></p>',document.body.appendChild(e);const t=e.querySelector("button");t.addEventListener("click",function(){e.style.display="none",localStorage.setItem("cookiesAccepted","true"),document.querySelectorAll(".download-btn").forEach(function(e){e.disabled=!1})})}"true"===localStorage.getItem("cookiesAccepted")?document.querySelectorAll(".download-btn").forEach(function(e){e.disabled=!1}):(document.querySelectorAll(".download-btn").forEach(function(e){e.disabled=!0}),s())});