document.addEventListener("DOMContentLoaded",function(){function t(e){const t={timeZone:"America/New_York",weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"};return new Date(e).toLocaleString("en-US",t)}if("caches"in window)caches.open("my-gif-cache").then(function(t){document.querySelectorAll(".gif-item img").forEach(function(e){let o=e.dataset.gif;/^https?:\/\//.test(o)&&t.add(o).catch(t=>console.error("Failed to cache:",o,t))})}).catch(t=>console.error("Failed to open cache:",t));const e=document.getElementById("toggleDarkMode"),o=document.body;e&&e.addEventListener("click",()=>{o.classList.toggle("dark-mode"),localStorage.setItem("darkMode",o.classList.contains("dark-mode"))}),"true"===localStorage.getItem("darkMode")&&o.classList.add("dark-mode");const r=document.querySelector(".gif-container");r&&r.addEventListener("click",e=>{if(!e.target.classList.contains("download-btn")){const r=e.target.closest(".gif-item");if(r){const e=r.querySelector("img");e.src.includes("placeholder.jpg")&&e.dataset.gif&&(e.src=e.dataset.gif);const t=document.querySelector(".fullsize-overlay");t&&document.body.removeChild(t);const o=document.createElement("div");o.className="fullsize-overlay";const r=document.createElement("img");r.src=e.src,r.className="fullsize-image",o.appendChild(r),document.body.appendChild(o),o.addEventListener("click",()=>document.body.removeChild(o))}}});const n=document.createElement("div");n.style.position="fixed",n.style.pointerEvents="none",n.style.zIndex="9999",document.body.appendChild(n);const a=[],c=5;for(let t=0;t<c;t++){const e=document.createElement("div");e.textContent="★",e.className="star",n.appendChild(e),a.push(e)}let i=0;document.addEventListener("mousemove",e=>{null!=e.clientX&&null!=e.clientY&&(a[i].style.left=e.clientX+"px",a[i].style.top=e.clientY+"px",a[i].style.opacity="1",setTimeout(()=>{a[i].style.opacity="0"},500),i=(i+1)%c)});document.querySelectorAll(".download-btn").forEach(function(e){const o=e.dataset.gif,r=e.nextElementSibling;fetch(`/.netlify/functions/get-download-count?gif_name=${encodeURIComponent(o)}`).then(t=>t.json()).then(t=>{if(r){r.textContent=`Downloads: ${t.count}`;if(t.timestamp){const e=document.createElement("div");e.textContent=`Last downloaded: ${t(t.timestamp)}`,r.parentNode.appendChild(e)}}}),e.addEventListener("click",async()=>{try{const e=await fetch("/.netlify/functions/update-download-count",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gif_name:o})}),t=await e.json();console.log("✅ Full response:",JSON.stringify(t)),r&&(r.textContent=`Downloads: ${t.count??"?"}`)}catch(e){console.error("Failed to update global count:",e)}const t=document.createElement("a");t.href=o,t.download=o,document.body.appendChild(t),t.click(),document.body.removeChild(t)})});const s=new IntersectionObserver((t,e)=>{t.forEach(t=>{if(t.isIntersecting){const e=t.target;e.dataset.gif&&e.src.includes("placeholder.jpg")&&(e.src=e.dataset.gif,s.unobserve(e))}})},{rootMargin:"400px"});document.querySelectorAll(".gif-item img").forEach(t=>{t.dataset.gif=t.src,t.src="placeholder.jpg",s.observe(t)});function d(){const t=document.createElement("div");t.id="consent-banner",t.innerHTML='<p>We use cookies to ensure you get the best experience. <button id="acceptConsent">Accept</button></p>',document.body.appendChild(t);t.querySelector("button").addEventListener("click",()=>{t.style.display="none",localStorage.setItem("cookiesAccepted","true"),document.querySelectorAll(".download-btn").forEach(t=>t.disabled=!1)})}"true"===localStorage.getItem("cookiesAccepted")?document.querySelectorAll(".download-btn").forEach(t=>t.disabled=!1):(document.querySelectorAll(".download-btn").forEach(t=>t.disabled=!0),d())});